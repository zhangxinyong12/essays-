<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: content-box;
        }

        p {
            height: 40px;
        }

        header {
            height: 60px;
            width: 100%;
            position: fixed;
            top: 0;
            z-index: 10;
            background-color: blue;
        }

        .cont {
            background-color: #999;
            display: flex;
            height: calc(100vh - 60px);
            overflow: auto;
            padding-top: 60px;
            position: relative;
        }

        .left {
            flex-basis: 200px;
            width: 200px;
            background-color: #999;
            position: sticky;
            top: 0;
        }

        .left p {
            height: 40px;
            border-bottom: 1px solid #999;
            border-top: 1px solid #444;
            background-color: #fff;
        }

        .right {
            flex: 1;
            background-color: #fff;
        }

        .right p {
            height: 60px;
            background-color: aquamarine;
            margin-top: 10px;
        }

        .t {
            display: inline-flex;
            width: 200px;
        }

        .t span {
            flex: 1;
        }
    </style>
</head>

<body>
    <!-- <header>
        000000000000
    </header> -->
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
        <path fill="#3366ff" fill-opacity="1"
            d="M0,288L48,256C96,224,192,160,288,138.7C384,117,480,139,576,133.3C672,128,768,96,864,117.3C960,139,1056,213,1152,256C1248,299,1344,309,1392,314.7L1440,320L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z">
        </path>
    </svg>
    <div>
        <div class="t">
            <span>1</span>
            <span>1</span>
            <span>1</span>
            <span>4</span>
        </div>
        <div class="t">
            <span>1</span>
            <span>1</span>
            <span>1</span>
            <span>4</span>
        </div>
    </div>
    <!-- <div class="cont">
        <div class="left">
            <p>1</p>
            <p>2</p>
            <p>3</p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p>555</p>
        </div>
        <div class="right">

            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
        </div>
    </div>
    <div>
        <p></p>
        <p></p>
        <p></p>
        <p></p>
        <p></p>
        <p></p>
        <p></p>
        <p></p>
        <p></p>
        <p></p>
        <p></p>
    </div> -->
</body>
<script>
    const p1 = Promise.resolve('1');
    const p2 = Promise.resolve('2');
    const p3 = Promise.resolve('3');
    Promise.all([p1, p2, p3]).then(res => {
        console.log('成功', res);
    }).catch(err => {
        console.log('失败', err);
    });


    let failedList = []
    function getDataById(id) { // 这是单个请求
        return new Promise(function (resolve, reject) {
            getResponse(id, resolve, reject)
        }).catch(e => {
            failedList.push(arguments.callee(id)) // 如果失败，就重新发起请求，并将该请求的promise放入failedList中以便后续处理
        })
    }
    function getResponse(id, resolve, reject) { // 模拟返回结果
        setTimeout(() => {
            if (Math.random() > 0.8) resolve({ id, msg: 'ok' })
            else reject({ id, msg: 'error' })
        }, 1000)
    }
    const RequestList = [getDataById(1), getDataById(2), getDataById(3)]
    fetchData(RequestList)
    let counter = 1 // 请求次数
    let maxRequestTimes = 5 // 最大请求次数，因为有可能别个页面就是访问不了，请求多少次也没用- - 
    let result = [] // 最后的结果
    function fetchData(requestList) { // 这里是对请求结果的处理
        Promise.all(requestList).then(resolve => {
            result = result.concat(resolve.filter(i => i)) // filter返回true的时候保留该数组项，因为getDataById的catch里没有给返回值（这里也不需要），这里的resolve里就会有undefined，需要过滤掉
            let failedLength = failedList.length
            if (failedLength > 0 && counter < maxRequestTimes) { // 如果失败列表里有请求，并且请求次数不超过设定的值，就进行下一次请求，并且打出log
                console.log(`第${counter}次请求完成，其中成功${RequestList.length - failedLength}个，失败${failedLength}个，正在进行第${++counter}次请求...`)
                fetchData(failedList)
                failedList = [] // 这里要清空failedList，不然会一直调用。不用担心，下一次请求失败的会在getDataById填充到failedList里。
            } else { // 表示所有请求都成功了，或者达到了最大请求次数。到这里就可以对result做进一步处理了。
                console.log(`请求完成，共请求${counter}次, 其中成功${RequestList.length - failedLength}个，失败${failedLength}个\n`, result)
                counter = 1
            }
        }).catch(e => {
            console.log(e)
        })
    }
</script>
<!-- <script>
    function debounce(fn, delay) {
        let timer = null;
        return function () {
            let context = this;
            let args = arguments;
            clearTimeout(timer);
            timer = setTimeout(function () {
                fn.apply(context, args);
            }, delay);
        }
    }

    function foo() {
        console.log('foo');
    }

    const contRef = document.querySelector('.cont');
    contRef.addEventListener('scroll', debounce(foo, 2000));


    const de = (fn, delay) => {
        let timer = null;
        clearTimeout(timer);
        timer = setTimeout(() => {
            fn();
        }, delay);
    }
    function foo2() {
        console.log('foo2');
    }
    contRef.addEventListener('scroll', debounce(foo2, 2000));

    function dog(food) {
        console.log(this, '狗吃的' + food);
    }
    function cat(food) {
        console.log(this, '猫吃的' + food);
    }

    dog('狗粮');
    dog.apply('', ['狗粮']);
    dog.call(null, '狗粮');


    var removeDuplicates = function (nums) {
        for (let i = 0; i < nums.length; i++) {
            const item = nums[i];
            const filtersArr = nums.filter(el => el === item);
            if (filtersArr >= 2) {
                nums.splice(i, 1);
                i--
            }
        }
        return nums.length;
    };

    const arr = [1, 1, 2];
    removeDuplicates(arr);
</script> -->

</html>